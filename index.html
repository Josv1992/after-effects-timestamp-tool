<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

    <script>
        const FPS = 30;

        const processTracklist = (input) => {
            let outputString = '';

            input = input.trim();

            const lines = input.split('\n');

            const lastLine = lines[lines.length - 1].split(' ').slice(1).join(' ').trimStart();

            for (let i = 0; i < lines.length - 1; i++) {
                const line = lines[i];
                const firstSpaceIndex = line.indexOf(' ');

                const timestamp = convertTimeToFrames(lines[i + 1].split(' ')[0]);
                const trackName = line.slice(firstSpaceIndex + 1).trim();

                outputString += `if (t < ${timestamp}) {\n    "${trackName}"\n} else `;
            }

            outputString += `{\n    "${lastLine}"\n}`;
            return outputString;
        }

        function convertTimeToFrames(time) {
            let semiColons = time.split(':').length - 1;
            if (semiColons === 1) {
                let [minutes, seconds] = time.split(':');
                return parseInt(minutes) * 60 * FPS + parseInt(seconds) * FPS;
            } else if (semiColons === 2) {
                let [hours, minutes, seconds] = time.split(':');
                return (parseInt(hours) * 3600 + parseInt(minutes) * 60 + parseInt(seconds)) * FPS;
            }
        }

        function escapeHtml(input) {
            return input
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        document.addEventListener("DOMContentLoaded", () => {
            const outputDiv = document.getElementById('outputDiv');

            const inputTextArea = document.getElementById('inputTextArea');
            const processButton = document.getElementById('processButton');
            const copyButton = document.getElementById('copyButton');

            processButton.addEventListener('click', () => {
                const output = processTracklist(inputTextArea.value);
                outputDiv.innerHTML = escapeHtml(output);
                hljs.highlightElement(outputDiv);
                copyButton.style.visibility = 'visible';
            });
        });

        function copyToClipboard() {
            const outputDiv = document.getElementById('outputDiv');
            const textToCopy = outputDiv.innerText;

            navigator.clipboard.writeText(textToCopy)
                .then(() => {
                    showNotification('Result copied to clipboard!', 'success');
                })
                .catch(err => {
                    showNotification(err, 'error');
                });
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerText = message;

            if (type === 'success') {
                notification.style.backgroundColor = '#8dd088';
            } else if (type === 'error') {
                notification.style.backgroundColor = '#a25656';
            }
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 1000);
        }

    </script>
</head>
<link href="/css/style.css" rel="stylesheet" type="text/css" />

<body>

<div class="container">
    <label for="inputTextArea">Input:</label>
    <textarea id="inputTextArea" name="tracklist" rows="10" cols="50" placeholder="Tracklist"></textarea>
    <button id="processButton">Process</button>

    <p>Result:</p>
    <div class="output-container">
        <pre id="outputDiv" class="code-text-field javascript"></pre> <!-- Changed to <pre> for preserving line breaks -->
    </div>
    <button class="copy-button" id="copyButton" onclick="copyToClipboard()">Copy To Clipboard</button>
</div>

</body>
</html>
